function t(t,e,i,s){Object.defineProperty(t,e,{get:i,set:s,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},a={},n=i.parcelRequiree27a;null==n&&((n=function(t){if(t in s)return s[t].exports;if(t in a){var e=a[t];delete a[t];var i={id:t,exports:{}};return s[t]=i,e.call(i.exports,i,i.exports),i.exports}var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(t,e){a[t]=e},i.parcelRequiree27a=n),n.register("dRo73",(function(e,i){var s,a;t(e.exports,"register",(()=>s),(t=>s=t)),t(e.exports,"resolve",(()=>a),(t=>a=t));var n={};s=function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)n[e[i]]=t[e[i]]},a=function(t){var e=n[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),n("dRo73").register(JSON.parse('{"50T4R":"index.73dfff32.js","3o4AU":"Skull.c68e0465.obj","4ATob":"skull.821d6c1d.jpg"}'));class r{constructor(){}update(t,e,i,s,a,n,r,h){this.x=0|t,this.y=0|e,this.z=i,this.u=s,this.v=a,this.nx=n,this.ny=r,this.nz=h}}class h{constructor(){}update(t){this.z=t.z,this.u=t.u,this.v=t.v,this.nx=t.nx,this.ny=t.ny,this.nz=t.nz}delta(t,e,i){const s=1/i;this.z=(e.z-t.z)*s,this.u=(e.u-t.u)*s,this.v=(e.v-t.v)*s,this.nx=(e.nx-t.nx)*s,this.ny=(e.ny-t.ny)*s,this.nz=(e.nz-t.nz)*s}}class o{constructor(t){this.data=t}static Zero(){return new o([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}static Ident(){return new o([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static RotateX(t,e){return new o([1,0,0,0,0,e,t,0,0,-t,e,0,0,0,0,1])}static RotateY(t,e){return new o([e,0,-t,0,0,1,0,0,t,0,e,0,0,0,0,1])}static RotateZ(t,e){return new o([e,t,0,0,-t,e,0,0,0,0,1,0,0,0,0,1])}static RotateAngleX(t){return this.RotateX(Math.sin(t),Math.cos(t))}static RotateAngleY(t){return this.RotateY(Math.sin(t),Math.cos(t))}static RotateAngleZ(t){return this.RotateZ(Math.sin(t),Math.cos(t))}static Move(t,e,i){return new o([1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1])}static Scale(t,e,i){return new o([t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1])}Mult(t){const e=o.Zero();for(let i=0;i<4;++i)for(let s=0;s<4;++s)for(let a=0;a<4;++a)e.data[i+4*s]=e.data[i+4*s]+this.data[a+4*s]*t.data[i+4*a];return e}}class l{constructor(t){this.data=t}get(t){const e=this.data,i=3*t;return[e[i],e[i+1],e[i+2]]}set(t,e){const i=this.data,s=3*t;i[s]=e[0],i[s+1]=e[1],i[s+2]=e[2]}length(){return this.data.length/3}transformTo(t,e){const i=this.data,s=e.data,a=t.data;for(let t=0;t<i.length;t+=3){const e=i[t],n=i[t+1],r=i[t+2],h=e*a[3]+n*a[7]+r*a[11]+a[15];s[t]=(e*a[0]+n*a[4]+r*a[8]+a[12])/h,s[t+1]=(e*a[1]+n*a[5]+r*a[9]+a[13])/h,s[t+2]=(e*a[2]+n*a[6]+r*a[10]+a[14])/h}}}class u{constructor(t){this.data=t}get(t){const e=this.data,i=3*t;return[e[i],e[i+1],e[i+2]]}set(t,e){const i=this.data,s=3*t;i[s]=e[0],i[s+1]=e[1],i[s+2]=e[2]}length(){return this.data.length/3}transformTo(t,e){const i=this.data,s=e.data,a=t.data;for(let t=0;t<i.length;t+=3){const e=i[t],n=i[t+1],r=i[t+2];s[t]=e*a[0]+n*a[4]+r*a[8],s[t+1]=e*a[1]+n*a[5]+r*a[9],s[t+2]=e*a[2]+n*a[6]+r*a[10]}}scale(t){for(let e=0;e<this.data.length;e+=1)this.data[e]=this.data[e]*t}}class c{constructor(t){this.data=t}get(t){const e=this.data,i=2*t;return[e[i],e[i+1]]}set(t,e){const i=this.data,s=2*t;i[s]=e[0],i[s+1]=e[1]}length(){return this.data.length/2}}class d{constructor(t){this.data=t}get(t){const e=this.data,i=3*t;return[e[i],e[i+1],e[i+2]]}length(){return this.data.length/3}set(t,e){const i=this.data,s=3*t;i[s]=e[0],i[s+1]=e[1],i[s+2]=e[2]}}class p{constructor(t,e,i,s,a,n,r,h,o,l=null){this.x=t,this.y=e,this.z=i,this.rotationX=s,this.rotationY=a,this.rotationZ=n,this.scaleX=r,this.scaleY=h,this.scaleZ=o,this.parent=l}static Shift(t,e,i,s=null){return new p(t,e,i,0,0,0,1,1,1,s)}static Rotation(t,e,i,s=null){return new p(0,0,0,t,e,i,1,1,1,s)}static Scale(t,e,i,s=null){return new p(0,0,0,0,0,0,t,e,i,s)}static Empty(t=null){return new p(0,0,0,0,0,0,1,1,1,t)}matrix(){const t=o.Ident().Mult(o.Scale(this.scaleX,this.scaleY,this.scaleZ)).Mult(o.RotateAngleZ(this.rotationZ)).Mult(o.RotateAngleX(this.rotationX)).Mult(o.RotateAngleY(this.rotationY)).Mult(o.Move(this.x,this.y,this.z));return this.parent?t.Mult(this.parent.matrix()):t}inverseMatrix(){const t=o.Ident().Mult(o.Move(-this.x,-this.y,-this.z)).Mult(o.RotateAngleY(-this.rotationY)).Mult(o.RotateAngleX(-this.rotationX)).Mult(o.RotateAngleZ(-this.rotationZ)).Mult(o.Scale(1/this.scaleX,1/this.scaleY,1/this.scaleZ));return this.parent?this.parent.inverseMatrix().Mult(t):t}rotationMatrix(){const t=o.Ident().Mult(o.RotateAngleZ(this.rotationZ)).Mult(o.RotateAngleX(this.rotationX)).Mult(o.RotateAngleY(this.rotationY));return this.parent?t.Mult(this.parent.rotationMatrix()):t}inverseRotationMatrix(){const t=o.Ident().Mult(o.RotateAngleY(-this.rotationY)).Mult(o.RotateAngleX(-this.rotationX)).Mult(o.RotateAngleZ(-this.rotationZ));return this.parent?this.parent.inverseRotationMatrix().Mult(t):t}}class g{constructor(t,e,i,s,a){this.vertexes=t,this.normals=e,this.textures=i,this.triangles=s,this.normalIndexes=a}length(){return this.triangles.length()}getTexture(t){return[this.textures.data[6*t+0],this.textures.data[6*t+1],this.textures.data[6*t+2],this.textures.data[6*t+3],this.textures.data[6*t+4],this.textures.data[6*t+5]]}}class w{constructor(t,e,i){this.data=t,this.width=e,this.height=i,this.update(t,e,i)}update(t,e,i){this.data=t,this.width=0|e,this.height=0|i}getPuxel(t,e){return this.data[t*this.width|0+(e*this.height|0)*this.width]}}var x;x=new URL(n("dRo73").resolve("3o4AU"),import.meta.url).toString();var f;f=new URL(n("dRo73").resolve("4ATob"),import.meta.url).toString();let y=document.querySelector("canvas");y.width=900,y.height=900;const m=y.getContext("2d"),M=m.createImageData(900,900),v=new Uint32Array(M.data.buffer),U=p.Shift(450,800,0),A=new class{constructor(t,e,i=p.Empty()){this.texture=t,this.model=e,this.transform=i}}(new class{constructor(t){let e=new Image;e.crossOrigin="anonymous",e.onload=()=>{const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0),this.texture.update(new Uint32Array(i.getImageData(0,0,e.width,e.height).data.buffer),e.width,e.height)},e.onerror=()=>{console.error(`cant load image ${t}`)},e.src=t,this.texture=new w(new Uint32Array([4278255360]),1,1)}}(e(f)).texture,new class{constructor(t){fetch(t).then((t=>t.text())).then((t=>this.load(t))).catch((e=>console.error(`cant load file ${t}: ${e}`))),this.model=new g(new l(new Float32Array(0)),new u(new Float32Array(0)),new c(new Float32Array(0)),new d(new Uint32Array(0)),new d(new Uint32Array(0)))}load(t){const e=[],i=[],s=[],a=[],n=[],r=[];t.split("\n").map((t=>{const h=t.trim().split(" ").filter(Boolean);if(0!=h.length)switch(h[0]){case"v":e.push(+h[1]),e.push(+h[2]),e.push(+h[3]);break;case"vn":i.push(+h[1]),i.push(+h[2]),i.push(+h[3]);break;case"vt":s.push(+h[1]),s.push(+h[2]);break;case"f":const t=h[1].split("/");for(let e=3;e<h.length;++e){const i=h[e-1].split("/"),o=h[e].split("/");n.push(+t[0]-1|0),n.push(+i[0]-1|0),n.push(+o[0]-1|0),r.push(+t[2]-1|0),r.push(+i[2]-1|0),r.push(+o[2]-1|0),a.push(s[2*(+t[1]-1|0)]),a.push(1-s[2*(+t[1]-1|0)+1]),a.push(s[2*(+i[1]-1|0)]),a.push(1-s[2*(+i[1]-1|0)+1]),a.push(s[2*(+o[1]-1|0)]),a.push(1-s[2*(+o[1]-1|0)+1])}}})),this.model.vertexes=new l(new Float32Array(e)),this.model.normals=new u(new Float32Array(i)),this.model.textures=new c(new Float32Array(a)),this.model.triangles=new d(new Uint32Array(n)),this.model.normalIndexes=new d(new Uint32Array(r))}}(e(x)).model,p.Rotation(Math.PI/2,0,Math.PI,p.Scale(25,25,25,U))),b=new class{constructor(t,e,i,s){this.data=t,this.width=e,this.height=i,this.light=s,this.width=0|e,this.height=0|i,this.depth=new Float32Array(e*i),this.iUp1=new h,this.iUp2=new h,this.iDown1=new h,this.iDown2=new h,this.iDelta1=new h,this.iDelta2=new h}inSqrt(t,e,i){return 1/Math.sqrt(t*t+e*e+i*i)}phong(t,e,i,s){let a=255&t,n=(65280&t)>>8,r=(16711680&t)>>16;const h=this.inSqrt(e,i,s);i*=h,s*=h;const o=(e*=h)*this.light.vector[0]+i*this.light.vector[1]+s*this.light.vector[2],l=2*s*o-this.light.vector[2],u=o<0?0:o,c=l<0?0:l,d=this.light.embient,p=u*this.light.diffuse,g=this.light.power(c);return a=Math.min(255,a*(d+p)+this.light.r*g|0),n=Math.min(255,n*(d+p)+this.light.g*g|0),r=Math.min(255,r*(d+p)+this.light.b*g|0),4278190080|a|n<<8|r<<16}drawTrapezoid(t,e,i,s,a,n,r,h,o,l,u){const c=i/r|0,d=s/h|0,p=i%r,g=s%h;let w=this.iUp1.z,x=this.iUp1.u,f=this.iUp1.v,y=this.iUp1.nx,m=this.iUp1.ny,M=this.iUp1.nz,v=this.iUp2.z,U=this.iUp2.u,A=this.iUp2.v,b=this.iUp2.nx,R=this.iUp2.ny,D=this.iUp2.nz,z=this.iDelta1.z,T=this.iDelta1.u,I=this.iDelta1.v,S=this.iDelta1.nx,F=this.iDelta1.ny,Z=this.iDelta1.nz,Y=this.iDelta2.z,k=this.iDelta2.u,B=this.iDelta2.v,X=this.iDelta2.nx,j=this.iDelta2.ny,O=this.iDelta2.nz,E=o*this.width;for(;o<l;++o){const l=1/(e-t),_=(v-w)*l,q=(U-x)*l,H=(A-f)*l,L=(b-y)*l,P=(R-m)*l,C=(D-M)*l;let N=w,$=x,J=f,G=y,K=m,Q=M;if(o>=0&&o<this.height)for(let i=Math.max(t,0);i<Math.min(e,this.width-1);++i){N+=_,$+=q,J+=H,G+=L,K+=P,Q+=C;const t=E+i;if(N>this.depth[t]){this.depth[t]=N;const e=u.getPuxel($,J);this.data[t]=this.phong(e,G,K,Q)}}t+=c,e+=d,a+=p,n+=g,E+=this.width,Math.abs(a)>=r&&(t+=Math.sign(i),a-=r*Math.sign(p)),Math.abs(n)>=h&&(e+=Math.sign(s),n-=h*Math.sign(g)),w+=z,x+=T,f+=I,y+=S,m+=F,M+=Z,v+=Y,U+=k,A+=B,b+=X,R+=j,D+=O}return this.iUp1.z=w,this.iUp1.u=x,this.iUp1.v=f,this.iUp1.nx=y,this.iUp1.ny=m,this.iUp1.nz=M,this.iUp2.z=v,this.iUp2.u=U,this.iUp2.v=A,this.iUp2.nx=b,this.iUp2.ny=R,this.iUp2.nz=D,[t,e,a,n]}rawDrawTriangle(t,e,i,s){if(e.y<t.y&&e.y<=i.y){const s=t;t=e,e=i,i=s}else if(i.y<t.y&&i.y<=e.y){const s=t;t=i,i=e,e=s}const a=e.x-t.x,n=e.y-t.y,r=i.x-t.x,h=i.y-t.y;this.iUp1.update(t),this.iDown1.update(i),this.iDelta1.delta(this.iUp1,this.iDown1,h),this.iUp2.update(t),this.iDown2.update(e),this.iDelta2.delta(this.iUp2,this.iDown2,n);const[o,l,u,c]=this.drawTrapezoid(t.x,t.x,r,a,0,0,h,n,t.y,Math.min(e.y,i.y),s);e.y<i.y?(this.iUp2.update(e),this.iDown2.update(i),this.iDelta2.delta(this.iUp2,this.iDown2,i.y-e.y),this.drawTrapezoid(o,e.x,r,i.x-e.x,u,0,h,i.y-e.y,e.y,i.y,s)):(this.iUp1.update(i),this.iDown1.update(e),this.iDelta1.delta(this.iUp1,this.iDown1,e.y-i.y),this.drawTrapezoid(i.x,l,e.x-i.x,a,0,c,e.y-i.y,n,i.y,e.y,s))}drawTriangle(t,e,i,s){(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)<0||this.rawDrawTriangle(t,e,i,s)}clear(t=0,e=-1e10){this.data.fill(t),this.depth.fill(e)}}(v,900,900,new class{constructor(t,e,i,s,a,n){this.color=e,this.embient=i,this.diffuse=s,this.specular=a,this.specularMult=n,this.bakeIterations=500,this.r=255&e,this.g=(65280&e)>>8,this.b=(16711680&e)>>16,this.rebakeSpecular(a,n);const r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.vector=[t[0]/r,t[1]/r,t[2]/r]}rebakeSpecular(t,e){this.specular=t,this.specularMult=e,this.bakedLight=[];for(let i=0;i<this.bakeIterations;++i)this.bakedLight.push(Math.pow(i/this.bakeIterations,t)*e)}power(t){return this.bakedLight[t*this.bakeIterations|0]}}([.4,0,.3],16777215,.1,.6,20,1)),R=new class{constructor(t){this.renderer=t,this.vertexBuf=new l(new Float32Array(65536)),this.normalBuf=new u(new Float32Array(65536)),this.objects=[]}pushObject(t){this.objects.push(t)}draw(t=4278190080){this.renderer.clear(t),this.objects.forEach((t=>this.drawObject(t)))}drawObject(t){const e=t.model,i=t.texture;this.vertexBuf.length()<e.vertexes.length()&&(this.vertexBuf=new l(new Float32Array(e.vertexes.data.length))),this.normalBuf.length()<e.normals.length()&&(this.normalBuf=new u(new Float32Array(e.normals.data.length))),e.vertexes.transformTo(t.transform.matrix(),this.vertexBuf),e.normals.transformTo(t.transform.rotationMatrix(),this.normalBuf);const s=new r,a=new r,n=new r;for(let t=0;t<e.length();++t){const r=e.triangles.get(t),h=e.normalIndexes.get(t),o=this.vertexBuf.get(r[0]),l=this.vertexBuf.get(r[1]),u=this.vertexBuf.get(r[2]),c=this.normalBuf.get(h[0]),d=this.normalBuf.get(h[1]),p=this.normalBuf.get(h[2]),g=e.getTexture(t);s.update(o[0],o[1],o[2],g[0],g[1],c[0],c[1],c[2]),a.update(l[0],l[1],l[2],g[2],g[3],d[0],d[1],d[2]),n.update(u[0],u[1],u[2],g[4],g[5],p[0],p[1],p[2]),this.renderer.drawTriangle(s,a,n,i)}}}(b);R.pushObject(A);let D=0,z=100;const T=t=>{z+=1,z>=100&&(z=0,console.log("fps = "+1e5/(t-D)),D=t),U.rotationY=t/3e3,R.draw(),m.putImageData(M,0,0),requestAnimationFrame(T)};requestAnimationFrame(T);